## Numerical Validation Plan for Task 2.2 ðŸ§ª

This plan outlines the steps to numerically validate the derived expression for $\frac{d}{dt}\mathcal{V}(\rho_t)$.

---

1.  **Simulate Ensemble:**
    * Generate an ensemble of $N_{runs}$ particles $\{X_t^i\}_{i=1}^{N_{runs}}$ representing the distribution $\rho_t$ at a chosen time $t$ (e.g., $t=0$). Initialize them randomly on $V(n,k)$.

2.  **Calculate Current State:**
    * Compute the current average functional from the ensemble:
      $$\mathcal{V}_{num}(t) = \frac{1}{N_{runs}} \sum_{i=1}^{N_{runs}} \frac{1}{2} \|X_t^i - X^*\|_F^2$$
    * Determine the consensus point $X_{\alpha,t}$ (either idealized $X_{\alpha,t} = X^*$ or calculated from the ensemble if testing the full CBO effect).

3.  **Calculate Theoretical RHS:**
    * For each particle $X_t^i$ in the ensemble, calculate the terms corresponding to the generator action:
        * $Term_A^i = \left\langle X_t^i - X^*, -\lambda P_{X_t^i}(X_{\alpha,t}) + \frac{\sigma^2 C_{n,k}'}{2} \|X_t^i - X_{\alpha,t}\|_F^2 X_t^i \right\rangle_F$
        * $Term_B^i = \frac{\sigma^2 k C_{n,k}'}{2} \|X_t^i - X_{\alpha,t}\|_F^2$
    * Average these terms over the ensemble to estimate the theoretical derivative:
      $$\frac{d\mathcal{V}}{dt}_{theory} = \frac{1}{N_{runs}} \sum_{i=1}^{N_{runs}} (Term_A^i + Term_B^i)$$

4.  **Simulate One Small Step:**
    * For each particle $X_t^i$, simulate one step of the CBO SDE using a **very small** time step $\Delta t_{check}$ (e.g., $10^{-4}$ or $10^{-5}$) to obtain $X_{t+\Delta t_{check}}^i$. Use the *same* $X_{\alpha,t}$ from step 2 for this simulation step.

5.  **Calculate Next State:**
    * Compute the average functional at the next time step from the evolved ensemble:
      $$\mathcal{V}_{num}(t+\Delta t_{check}) = \frac{1}{N_{runs}} \sum_{i=1}^{N_{runs}} \frac{1}{2} \|X_{t+\Delta t_{check}}^i - X^*\|_F^2$$

6.  **Calculate Numerical Derivative:**
    * Estimate the derivative using a finite difference:
      $$\frac{d\mathcal{V}}{dt}_{num} = \frac{\mathcal{V}_{num}(t+\Delta t_{check}) - \mathcal{V}_{num}(t)}{\Delta t_{check}}$$

7.  **Compare:**
    * Check if the theoretical estimate matches the numerical estimate:
      $$\frac{d\mathcal{V}}{dt}_{theory} \approx \frac{d\mathcal{V}}{dt}_{num}$$
    * Calculate the relative error to quantify the agreement.

---